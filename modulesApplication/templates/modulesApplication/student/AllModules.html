{% extends "modulesApplication/base_student.html" %}
{% load static %}

{% block title %}All Modules{% endblock %}

{% block head_css %}
    {{ block.super }}
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'modulesApplication/css/student/allmodules.css' %}">
{% endblock %}

{% block content %}
<div class="page-wrapper">
    <!-- IMAGE BAR -->
    <div class="image-box">
        <div class="ib-content">
            <h2><i class="fas fa-book-open"></i> All Modules</h2> <br>
        </div>
    </div>

    <!-- FORM BOX -->
    <div class="form-box">
        <div class="icon-img">
            <i class="fas fa-book-open"></i>
        </div>
        <h1> Module List </h1>
        {# module_summaries refer to the dictionary passed through with the render request #}
        <label for="year_filter">Filter by:</label> 
        <select class="dropdown" name="year" id="year_filter">
            <option value=0>Select Year</option>
        </select>
        <br>


        {% if module_summaries %}
            <ul>
                {% for year, modules in module_summaries.items %}
                    <br> <h2>Year {{ year|add:"-3" }}</h2>
                    <br>
                    {% for module in modules %}
                            <label class="moduleLabels">{{ module.module_code }} - {{ module.title }}</label>
                            <div class="panel" disabled="False" id="module">
                                <br>
                                <h4>Summary</h4>
                                <p>{{ module.summary }}</p>
                                <br>
                                <button style=background-color:orangered; class="moreInfoButton"
                                        onclick="myFunction('{{ module.module_code }}')"> Find out
                                    more...
                                </button>
                                <div class="{{ module.module_code }}" style="display: none;">
                                    <br>
                                    <h4>Learning Outcomes</h4>
                                    <p>{{ module.learning_outcomes }}.</p>
                                    <br><h4>Recommended Reading</h4>
                                    <p>{{ module.recommended_reading }}</p>
                                    <br><h4>Exam Format</h4>
                                    <p>{{ module.exam_format }}</p>
                                    <br><h4>Course Leaders</h4>
                                    {% for leader in module.course_leaders %}
                                        <p>- {{ leader }}</p>
                                    {% endfor %}

                                </div>
                                <br><br>
                                <hr>
                                <br>
                            </div>
                    {% endfor %}
                {% endfor %}

            </ul>
        {% else %}
            <p>No polls are available.</p>
        {% endif %}
    </div>

    <script>
        // Display/hide extra info
        function myFunction(mod_code) {
            let x = document.getElementsByClassName(mod_code)[0]
            console.log("Clicked " + mod_code);
            if (x.style.display === "none") {
                x.style.display = "block";
            } else {
                x.style.display = "none";
            }
        }

        //filtering by year
        const years = {"All Modules": 0, "Year 1": 1, "Year 2": 2, "Year 3": 3, "Year 4": 4};
        window.onload = function () {
            const yearSel = document.getElementById("year_filter");
            let y = 0;

            for (const x in years) {
                yearSel.options[yearSel.options.length] = new Option(x, x);
            }

            yearSel.onchange = function () {
                y = years[this.value]
                location.href = '/student/all-modules/sort/' + y;
            }
        }
    </script>
</div>
{% endblock %}